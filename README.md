# DateTime
日時処理ライブラリ

## 目的

Arduinoなどの組み込み向けに軽量な日付操作クラスを準備した\
GPSから取得時間とRTCチップとの相互変換する必要があり、
それらを内包した構成にした。\


## 日付処理について

計算機で日時処理するには、年,月,日,時,分,秒 をそのまま扱うのではなく、起源からどれくらい経ったか？ を求めるのが効率が良い。 \
UnixTimeも、1970/1/1からの経過秒を表している。\
　例えば、GMT(世界標準時)から、日本標準時に変換するには、9時間を足せばよいが、日付を考慮しないと、32時というありえない時間になってしまう。

日付から、経過日を求める際、必ず考慮しないといけないのが「閏年」の考え方である。
そこで、一般的な閏年を考慮したフェアフィールドの公式や、ツェラーの公式を用いる。

フェアフィールドの公式(ツェラーの公式)は、[Wikipediaにも掲載](https://ja.wikipedia.org/wiki/%E3%83%84%E3%82%A7%E3%83%A9%E3%83%BC%E3%81%AE%E5%85%AC%E5%BC%8F)されているほどよく見るが、逆変換つまり経過日から日付に戻すアルゴリズムがあまり出回っていないと思う。

正変換(日付から経過日を求める)方は、条件分岐一回(1,2月の場合は、前年の13,14月に置換する)だけで、式一本で記述出来るが、\
逆変換の場合、素直に計算しようとすると、各月の日数を配列にもたせて、月でループしてそれらを加算しながら比較する、\
なんて言うやり方もあるが、やはりマイコンなどの組み込み用途には向かない。\
できるだけループを用いない方法を探し、結果として[出張ついでに釣りしましょ 様](https://maplus.naturum.ne.jp/e2662116.html) のコードが最もコンパクトであると考え、これを参考に実装、リファクタリングしている。\
本当は更に条件分岐を少なくした最適な処理を求めたいのだが、今のところ見つかっていない。

## 主な機能

+ 日付の計算(フェアフィールドの公式)\
　日付から、経過日を計算\
　経過日から日付を計算
+ GPS(TinyGPS++)からの変換
+ RTCレジスタ(BCD表記)の相互変換
+ UnixTimeの相互変換

## ソースについて

ソースは、C++で記述し、VisualC++で検証した。\
後ほど、Arduino互換のコードに修正予定だが、現状気をつkてほしいのは \
sprintf_sを使っていうのでその部分だけ適宜置き換えてもらいたい

END